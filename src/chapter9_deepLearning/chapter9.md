# Chapter 9 딥러닝을 이용한 주가 예측

-   "모바일 우선에서 인공지능 우선으로"
-   구글 텐서플로이용를 이용한 딥러닝 기반 주가 예측

<br>
<hr>
<br>

## 9.1 인공지능 artificial intelligence

### 9.1.1 인공지능 기술의 분류

-   인공지능, 머신러닝, 딥러닝

### 9.1.2 머신러닝

-   위키백과

    "머신러닝은 컴퓨터 시스템이 사용하는 알고리즘과 통계적 모델에 대한 과학적인 연구다.
    컴퓨터는 명시적인 지시 사항들을 이용하는 대신에 모델과 추론에 의존하여 효과적으로 작업을 수행한다.
    머신러닝은 인공지능의 하위 집합으로 간주된다"

-   카네기 멜론 대학 마첼 교수

    "컴퓨터 프로그램이 수행하는 작업T가 경험E를 통해서 성능 P만큼 향상된 것으로 측정될 때, 우리는 컴퓨터 프로그램이 학습한다고 말한다"

-   자동차 운전에 대입
    -   작업 T : 시각 센서를 이용하여 4차선 고속도로에서 운전하기
    -   성능 층정 P : 에러가 발생하기 전까지의 평균 이동 거리(인간 감독관의 판단에 따른)
    -   경험 훈련 E : 인간의 운전을 관찰하는 동안 기록된 일련의 이미지 및 조향 명령
    -   머신러닝은 인공지능의 하위 집합으로서, 기계가 수행하는 작업 T가 경험 E를 통해서 성능이 P 만큼 향상되는 것을 나타낸다

### 9.1.3 퍼셉트론 알고리즘

-   퍼셉트론은 여러 입력 신호(x1, x2)에 대하여 각각 고유한 가중치 (w1, w2)를 지니고 있다. <br>
    퍼셉트론은 입력받은 신호의 총합(x1w1 + x2w2)이 임계값(∅) 이하 이 때 0을 출력하지만 <br>
    입력받은 신호의 종합(x1w1 + x2w2)이 임계값(∅)을 넘어설 때 1을 출력하는데, 이를 활성화한다라고 표현한다.
-   퍼셉트론 구조를 변경하지 않으면서 매개변수(가중치와 임계값)만 변경함으로써 AND, NADD, OR 세 가지의 논리 회로를 만들 수 있다.

    -   예를 들어 w1, w2, ∅ 값을 각각 0.5, 0.5, 0.7로 설정하면 AND 논리 회로와 동일하게 동작한다.

    -   [AND](./and.py)
    -   [NAND](./nand.py)
    -   [OR](./or.py)

-   참고로 다중 퍼셉트론을 이용하여 컴퓨터도 만들어 낼 수 있는 것으로 알려져 있다.
    -   전 세계 100여 개가 넘는 대학교와 고등학교에서 NAND 논리 회로를 이용해서 테트리스 게임이 가능한 컴퓨터를 만드는 강의를 개설
    -   [nand2tetris](https://www.nand2tetris.org/)

### 9.1.4 활성화 함수

입력 신호의 총합이 임계값을 넘어 설 때 특정값을 출력하는 함수를 활성화 함수 activation function라고 한다.

-   출력 신호가 계단 모양을 닮은 계단 함수, 출력 신호가 S자를 닮은 시그모이드 함수, 최근 들어 시그모이드 함수를 대체해 사용하는 ReLU 함수 등 다양한 활성화 함수가 있는데 함수들이 지닌 특징을 살펴보자.

<br>

#### **계단 함수 step function**

계단 함수는 출력 신호가 계단 모양과 유사
계단 함수를 파이썬으로 구현해보면 x좌표의 0을 경계로 출력값이 0에서 1로 변경된다.

-   [stepFunction](./stepFunction.py)

<br>

#### **시그모이드 sigmoid 함수**

-   라틴 문자 S를 닮았다는 의미를 가지고 있으며, 실제로 시그모이드 함수에 의해 출력되는 결과는 S자와 유사

    $$
    y = \frac{1}{1 + e^{-x}}
    $$

-   시그모이드 함수를 사용할 경우 0 ~ 1 사이의 연속적인 실수가 출력된다.

    -   퍼셉트론의 활성화 함수를 계단 함수에서 시그모이드 함수로 변경해 비로소 복잡한 신경망에 대한 계산도 가능해졌다.

-   [sigmoidFunction](./sigmoidFunction.py)

<br>

#### **tanh 함수**

-   쌍곡탄젠트 함수는 시그모이드 함수처럼 S자 모양의 그래프로 표시되지만, 시그모이드 함수가 0~1 사이의 값을 출력하는 것에 비해 쌍곡탄젠트 함수는 -1~1 사이의 값을 출력한다는 차이점이 있다.
    $$
    y = \frac{e^x - e^{-x}}{e^x + e^{-x}}
    $$
-   [tanh](./tanh.py)

<br>

#### **ReLU 함수**

-   신경망 분야에서는 오래전부터 시그모이드 함수를 사용해 왔지만 최근 들어서 ReLU rectified linear unit 함수가 주로 사용
    -   rectified : '정류된'
    -   음수를 0으로 만든다
    -   입력이 0 이하일 경우에는 0을 출력하지만 입력이 0을 넘으면 입력 받은 값을 그대로 출력한다.
-   [ReLUFunction](./ReLUFunction.py)

<br>

#### **소프트맥스 softmax 함수**

-   분류 문제를 다룰 때 사용되는 활성화 함수로 입력받은 값들을 0 ~ 1 사이 값으로 정규화한다.
    -   출력값들의 총합은 항상 1이 된다. - 입력값 x가 n개일 때 다음과 같은 수식으로 나타낼 수 있다.
        $$
        y = \frac{e^x}{\sum_{k=1}^n e^{x_k}}
        $$
-   [SoftmaxFunction](./SoftmaxFunction.py)

<br>

#### **다층 퍼셉트론 multi-layer perceptron, MLP**

-   [MLP_OutpuLayer](./MLP_OutpuLayer.py)

<br>

### 9.1.6 딥러닝

-   기존 머신러닝에서는 사람이 기계가 학습할 데이터 특징을 설계했지만, 딥러닝에서는 데이터 입력에서부터 결과 출력까지 사람의 개입을 배제할 수 있다.

<br>
<hr>
<br>

## 9.2 텐서플로 TensorFlow 기초

구글 브레인팀에서 심층 신경망 연구를 위해 개발한 머신러닝 라이브러리

-   pip install tensorflow
-   성능을 고려해 코어를 C++로 구현 - 최신 버전 파이썬이나 32비트 파이썬에서는 지원되지 않는 경우가 있다. - http://tensorflow.org - 지원하는 파이썬 버전 확인 후 venv를 이용해 가상 환경에서 바이썬 버전을 다시 설치해야 한다.

<br>

### 9.2.1 텐서플로에서 문자열 출력하기

-   [tensorflow_stirng](./tensorflow_stirng.py)
-   텐서플로 2.x 버전에서 print() 함수로 hello 노드를 출력하면 해당 노드가 갖고 있는 바이트 문자열이 바로 표시된다.
    -> (chaptGPT) print(hello.numpy().decode('utf-8'))

<br>

### 9.2.2 텐서의 차원

텐서플로에서 모든 데이터는 tensor 데이터 구조를 사용해서 표현

-   동적 크기를 지니는 다차원 데이터 배열 정도로 생각하면 된다.
-   텐서는 n차원 배열이나 리스트로 표현할 수 있으며, 프로그램 내에서 모든 데이터는 텐서의 형태로 이동한다.
    -   각 텐서는 차원 rank, 형태 shape, 자료형 data type을 지니는데, 차원은 동적으로 변할 수 있다.

<br>
<hr>
<br>

## 9.3 선형 회귀 문제

텐서플로 저수준 API를 사용해서 선형 회귀 문제를 풀어보자.

-   간단한 예지이지만 머신러닝에 필요한 기본 개념과 처리 순서를 배울 수 있으므로 향후 복잡한 딥러닝 문제를 푸는 연습 문제 역할

### 9.3.1 선형 모델

y = ax + b 형태의 직선의 방정식에 대한 x,y 값이 다음과 같이 주어졌을 때, 사람은 어렵지 않게 a값이 1이고, b값이 1이라는 사실을 알 수 있다.
| x | 1 | 2 | 3 | 4 | 5 |
|---|---|---|---|---|---|
| y | 2 | 3 | 4 | 5 | 6 |

-   선형 회귀 문제를 머신러닝으로 푼다는 것은 주어진 데이터를 가장 잘 나타내는 y = ax + b 공식, 즉 a와 b값을 찾아내는 것이다.
    -   머신러닝에서는 h(x) = wx + b라고 표현하는데, 표현만 다를 뿐 w값(가중치)과 b값(편향)을 알아내는 것은 똑같다.
    -   컴퓨터가 주어진 데이터를 이용하여 가설 h(x)에서 최적의 w값과 b값을 찾는 과정을 학습이라고 하며,
    -   w값과 b값을 알아내면 결국 임의의 x값이 주어졌을 때 그에 맞는 y값을 추론할 수 있게 된다.
-   [선형 회귀 문제의 학습 준비](./LinearRegression.py)

### 9.3.2 경사 하강 알고리즘 gradient descent algorithm

예측값 hypothesis과 실젯값 y_data가 얼마나 차이가 나는지 수치화한 것을 비용 cost 또는 손실 loss - 비용 함수는 예측값과 실제값의 차이를 제곱해서 평균 낸 값을 반환하는데, 이를 오차 제곱평균 mean_wquared_error, MSE

-   그래프의 기울기를 구하면서 단계적으로 최솟값을 구해가는 방식을 경사 하강 알고리즘
-   [선형 회귀 문제의 학습 준비](./LinearRegression.py)
-   위의 코드를 실행하면 스텝이 증가함에 따라 비용값이 점점 줄어드는 결과가 출력 - 이는 텐서플로를 이용해서 학습을 1100번 수행함으로써 y = 1.00 \* x + 1.00 직선을 찾아냈다는 것을 의미
    step| w| b| cost
    ----|-----|-----|-----
    1| 0.78| 0.72| 1.62
    3| 0.90| 0.76| 0.55
    5| 0.96| 0.78| 0.19
    10| 1.03| 0.80| 0.02
    1000| 1.00| 0.99| 0.00
    1100| 1.00| 1.00| 0.00

<br>
<hr>
<br>

## 9.4 RNN을 이용한 주가 예측 recurrent neural network, RNN

딥러닝 기술의 일종인 순환 신경망을 이용 - 주가 예측이 어떤 원리로 작동하는지를 설명하는 용도로 최소한으로 작성한 코드이기 때문에, 이를 이용하여 실제로 시장에서 투자하는 것은 절대 바람직하지 않다.

### 9.4.1 순환 신경망(RNN)

### 9.4.2 장단기 기억(LSTM)

### 9.4.3 주가 예측

[RNN_StockPrediction](./RNN_StockPrediction.py)

-   데이터 중에서 70%를 훈련용 데이터로 이용하고 30%를 테스트용 데이트로 이용
-   학습을 통해 모델이 완성되면, 예측된 종가와 실제 종가를 그래프로 그려서 비교
    -   그런 다음, 다음날 종가를 출력

### 9.4.4 데이터넷 준비하기

[RNN_StockPrediction](./RNN_StockPrediction.py)

### 9.4.5 훈련용 데이터셋과 테스트용 데이터셋 분리

[RNN_StockPrediction](./RNN_StockPrediction.py)

-   훈련용 데이터넷만 이용해서 학습하면 자칫 훈련용 데이터에만 최적화되어 새로운 데이터에 대해서 올바르게 추정하지 못하는 과적합 현상 생길 수 있다.

-   학습 과정에서 사용된 적이 없는 테스트용 데이터셋을 분리해서 사용함으로써 학습이 객관적으로 이루어졌는지 점검
-   데이터셋 중에서 70%는 훈련용으로 사용, 나머지는 테스트용

### 9.4.6 모델 생성하기

[RNN_StockPrediction](./RNN_StockPrediction.py)

케라스의 고수준 API를 사용하면 딥러닝 모델을 쉽게 만들 수 있다.

### 9.4.7 딥러닝의 학습

-   학습 과정에서 캐라스가 출력해 주는 정보를 확인해보면 실제로 Epoch 횟수가 증가할수록 손실 함수의 결괏값(loss)이 줄어든다.

### 9.4.8 예측치와 실제 종가 비교
