# Chapter 3

### 3.4.1

[3.4.1](./3.4.1.py)

### 3.4.2 일간 변동률로 주가 비교하기

오늘 변동률 = ((오늘 종가 - 어제 종가)/어제 종가) \* 100
[3.4.2](./3.4.2.py)

### 3.4.3 주가 일간 변동률 히스토그램

[3.4.3](./3.4.3.py)

histogram은 도수 분포 frequency distribution을 나타내는 그래프

-   데이터값들에 대한 구간별 빈도수를 막대 형태로 나타낸다.
-   구간 수를 bins, hist()함수에서 사용되는 빈스의 기본값은 10
-   출력된 결과를 보면 삼성전자 일간 변동률 분포가 0 bin을 기준으로 좌우 대칭적, 정규분포와 비슷
    -   주가 수익률은 정규분포보다 중앙 부분이 더 뾰족하고 분포의 양쪽 꼬리는 더 두터운 것으로 알려져 있다. 이를 각각 급첨 분포와 팻 테일
-   주가 수익률이 급첨 분포를 나타낸다는 것은 정규분포와 비교했을 때 주가의 움직임이 대부분 매우 작은 범위 안에서 발생한다는 것이다.
    -   그리고 두꺼운 꼬리를 가리카는 팻 테일은 '그래프와 좌우 극단 부분에 해당하는 아주 큰 가격 변동이 정규분포보다 더 많이 발생한다' 의미
-   시리즈의 describe() 메서드를 이용하면 평균과 표준편차를 확인
    -   count 162.000000 : 전체 데이터 개수
    -   mean -0.181763 : 평균값
    -   std 1.563260 : 표준편차

### 3.4.4 일간 변동률 누적합 구하기

[3.4.4](./3.4.4.py)

dec_dpc는 일간 변동률이기 때문에 종목별로 전체적인 변동률을 비교해보려면, 일단 변동률의 누적합 Cumulative Sum을 계산

-   누적합은 시리즈에서 제공하는 cumsum() 함수 이용

<br>

## 3.5 최대 손실 낙폭 MDD Maximum Drawdown

특정 기간에 발생한 최고점에서 최저점까지의 가장 큰 손실

-   퀀트 투자에서는 수익률을 높이는 것보다 MDD를 낮추는 것이 더 낫다
-   MDD = (최저점 - 최고점) / 최저점

### 3.5.1 KOSPI의 MDD

-75.8%

### 서브프라임 당시의 MDD

[3.5.2](./3.5.2.py)

시리즈.rolling(윈도우 크기 [, min_peridos=1])[.집계 함수()]

-   rolling() 함수는 시리즈에서 윈도우 크기의 해당하는 개수만큼 데이터를 추출하여 집계 함수에 해당하는 연산을 실시
    -   집계 함수 : max(), 평균값 mean(), min()
    -   min_periods를 지정하면 데이터 개수가 윈도우 크기에 못미치더라도 min_periods로 지정한 개수만 만족하면 연산을 수행
-   서브프라임 금융 위기 당시였던 2008년 10월 24일에 KOSP 지수가 10.57% 하락하면서 MDD가 -54.5% 기록, 정확한 MDD는 min() 함수

 <br>

## 3.6 회귀 Regression 분석과 상관관계

-   데이터의 상관관계를 분석하는 데 쓰이는 통계 분석 방법
    -   회귀 모형을 설정한 후 실제로 관측된 표본을 대상으로 회귀 모형읙 계수를 추정
    -   독립변수라고 불리는 하나 이상의 변수와 종속변수라 불리는 하나의 변수 간의 관계를 나타내는 회귀식이 도출되면,
        -   y = f(x), x 독립변수, y 종속변수
    -   임의의 독립변수에 대하여 종속변숫값을 추측해볼 수 있는데 이를 예측 preiction 이라고 한다.
-   키는 평균으로 회귀하려는 경향이 있음을 알아내고, 이때부터 회귀 분석이라는 용어 사용

### 3.6.1 KOSPI와 다우존스 지수 비교

[3.6.1](./3.6.1.py)

-   수의 기준값이 달라, 두 지수 중 어느 쪽이 더 좋은 성과를 냈는지 한눈에 파악하기 어렵다.

### 3.6.2 지수화 비교

[3.6.2](./3.6.2.py)

현재 종가를 특정 시점의 종가로 나누어 변동률을 구해보자

-   이를 지수화 indexation
    -   일간 변동률의 누적합을 구하는 것보다 더 수월하게 처리

### 3.6.3 산점도 Scatter plot 분석

[3.6.3](./3.6.3.py)

산점도란 독립변수 x와 종속변수 y의 상관관계를 확인할 때 쓰는 그래프

-   가로축은 독립변수 x, 세로축은 종속변수 y
-   미국 시장과 국내 시장의 상관관계를 알아보고자 x를 다우존스 지수로, y를 KOSPI 지수
-   y = x 인 직선 형태에 가까울수록 직접적인 관계가 있다.
-   정확한 분석이 어려우므로 선형 회귀 분석

### 3.6.4 사이파이 SciPy 선형 회귀 분석

사이파이 SciPy는 파이썬 기반 수학, 과학, 엔지니어링용 핵심 패키지 모음

-   pip install scipy

### 3.6.5 선형 회귀 분석 linear regression model

---

$$
Y_i = \beta_0 + \beta_1 X_i + \epsilon_i \quad (i = 1, 2, \dots, n)
$$

-   \( Y_i \): \( i \)번째 **종속변수**의 값
-   \( X_i \): \( i \)번째 **독립변수**의 값
-   \( \beta_0 \): 선형 회귀식의 **절편** (intercept)
-   \( \beta_1 \): 선형 회귀식의 **기울기** (slope)
-   \( \epsilon_i \): **오차항** (종속변수 \( Y \)의 실제값과 기대값의 차이)

---

-   회귀 모델이란 연속적인 데이터 Y와 이 Y의 원인이 되는 X간의 관계를 추정하는 관계식을 의미
    -   실제로 데이터 값에는 측정 상의 한계로 인한 잡음 noise 이 존재하기 때문에 정확한 관계식을 표현하는 확률 변수와 오차항을 두게 된다.
-   독립변수 X와 종속변수 Y의 관계가 다음처럼 1차식으로 나타날 때 선형 회귀 모델이라고 부른다.
-   사이파이 패키지의 서브 패키지인 stats는 다양한 통계 함수 제공
    -   model = stats.linear(독립변수 x, 종속변수 y)

[3.6.5](./3.6.5.py)

<br>

## 3.7 상관계수 Corefficient of Crrelation 에 따른 리스크 완화

독립변수와 종속변수 사이의 상관관계를 나타내는 수치

-   상관계수 r은 항상 -1 <= r <= 1 을 만족

### 3.7.1 데이터프레임으로 상관계수 구하기

[3.7.1](./3.7.1.py)

데이터프레임은 상관계수를 구하는 corr() 함수 제공, 데이터프레임 각 칼럼간의 상관계수를 쉽게 구할 수 있다.

-   DOW 지수와 KOSPI 지수의 상관계수가 0.819173

### 3.7.2 시리즈로 상관계수 구하기

[3.7.1](./3.7.1.py)

### 3.7.3 결정계수 R-squared 구하기

[3.7.1](./3.7.1.py)

관측된 데이터에서 추정한 회귀선이 실제로 데이터를 어느 정도 설명하는지를 나타내는 계수

-   두 변수의 상관관계 정도를 나타내는 상관계수를 제곱한 값
-   데이터프레임의 corr() 함수의 결과는 테이블 형태, 여기서는 제일 간편한 방식인 시리즈의 corr() 함수를 사용해 상관계수를 구하겠다.
-   결정계수는 상관계수를 제곱
-   결정계수가 1이면 모든 표본 관측치가 추정된 회귀선 상에만 있다는 의미
    -   추정된 회귀선이 변수 간의 관계를 완벽히 설명
    -   반면 결정계수가 0이면 추정된 회귀선이 변수 사이의 관계를 전혀 설명하지 못한다는 의미

### 3.7.4 다우존스 지수와 KOSPI의 회귀 분석

[3.7.4](./3.7.4.py)
스탯츠 모델의 linregress() 함수를 이용하여 선형회귀 모델을 생성한 뒤 회귀선을 그려서 분석

-   다우존스 지수와 KOSPI 지수의 상관계수 0.83
    -   두 자산에 분산 투자를 할 경우 약간의 리스크 완화 효과를 기대
-   회귀식은 Y = 0.06 \* X + 620.95
    -   임의의 다우존스 지수 값이 주어졌을 때 KOSPI 지수가 대략 어떤 값을 나타낼지 예측해볼 수 있다.
-   동일하게 미국 국체 TLT vs KOSPI
    [3.7.4_2](./3.7.4_2.py)
    -   상관계수 0.67
    -   Y = 21.12 \* X \_ -492.29
    -   다우존스에 비해 0.16 낮다.
-   국내 주식에 이미 투자를 하고 있다면 다우존스 지수에 분산 투자하는 것보다 미국 채권에 분산 투자하는 것이 리스크 완화에 도움이 된다.

### 3.7.5 상관계수에 따른 리스크 완화

-   현대포트폴리오 이른 - '투자에 대한 수익과 위험은 평균과 분산으로 나타낼 수 있으며, 상관관계가 낮은 자산을 대상으로 분산 투자하면 위험을 감소시킬 수 있다.'

| 상관계수 | 리스크 완화 효과                    |
| -------- | ----------------------------------- |
| +1.0     | 리스크 완화 효과가 없음             |
| +0.5     | 중간 정도의 리스크 완화 효과가 있음 |
| 0        | 상당한 리스크 완화 효과가 있음      |
| -0.5     | 대부분의 리스크를 제거함            |
| -1.0     | 모든 리스크 제거함                  |

<br>

## 3.8 핵심요약

-   팬더스 제공
    -   시리즈 : 인덱스를 지니는 1차원 벡터, 데이터 프레임의 칼럼에 해당
    -   데이터프레임 : 인덱스를 지니는 테이블 형태 자료형
-   팬더스 이용 : 엑셀, HTML, 데이터베이스로부터 데이터를 읽어 데이터프레임 형태로 가공
-   가격대가 다른 두 주식 종목의 수익률을 비교하려면 종가 대신 일간 변동률의 누적합을 구해서 비교
-   MDD(최대 손실 낙폭) : 포트폴리오의 특정 기간 중 최고점부터 최저점까지의 가장 큰 손실을 의미
    -   수익률을 높이는 것만큼이나 MDD를 낮추는 것이 중요
-   회귀 분석 : 데이터의 상관관계를 분석하는 데 많이 쓰이는 통계 분석 방법
    -   회귀식을 구한 뒤 임의의 독립변수에 대하여 종속변수의 값을 추측해볼 수 있는데, 이를 예측이라고 한다.
-   오늘의 종가를 특정일의 종가로 나눈 뒤 100을 곱하면, 특정일의 종가 대비 오늘의 변동률을 구할 수 있다.
    -   이허게 가격이 다른 두 주식 종목의 수익률을 비교하는 방법을 지수화라고 한다.
-   상관계수란 독립변수와 종속변수 사이의 상관관계의 정도를 나타내는 수치
    -   양의 상관관계가 가장 강한 값을 1로, 음의 상관관관계가 가장 강한 값을 -1로 나타내며, 상관관계가 없을 때 0이다.
-   상관계수는 시리즈나 데이터프레임에서 corr() 함수를 호출해서 구할 수 있고, 사이파이의 서브 패키지인 스탯츠로 선형회귀ㅜ 모델을 생성하여 구할 수도 있다.
-   현대 포트폴리오 이론의 성과 중 하나는 주식과 채권처럼 상관관계가 낮은 자산으로 포토플리오를 구성함으로써, 포트폴리오의 전반적인 위험을 줄 이 ㄹ수 있다는 것을 알려주었다는 점이다.
