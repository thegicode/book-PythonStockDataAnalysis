# Chapter 8 변동성 돌파 전략과 자동매매

-   레리 윌리엄스의 변동성 돌파 전략

<br>
<hr>
<br>

## 8.1 레리 윌리엄스의 변동성 돌파 전략 Volatility Breakout Strategy

-   가격이 전일 가격 범위의 K% 이상이 될 때 매수한 후 장 마감시 매도해서 수익을 실현하는 단기 트레이딩 기법
-   추세가 한 번 형성되면 가격은 계속 그 방향으로 움직인다는 추세 추종 Trend following 이론에 기반한다.
-   래리 윌리엄스가 개발한 Williams %R 지표는 스토캐스틱에서 파생되었다.
    -   일정 기간 동안의 최고가와 최저가 중심축에서 현재가가 중심축의 어느 위치에 있는지를 %로 표시한다.

### 8.1.1 현동성 돌파 전략

-   일 day 단위로 이루어지는 단기 매매기법
-   매매 기간이 하루를 넘기지 않고 무조건 종가에 매도하기 때문에 장마감 후 악재가 발생하더라도 매매에 영향을 미치지 않아 안전하다.
    -   1. 전날의 고가 high 에서 저가 low를 빼서 가격 변동폭을 계산한다.
    -   2. 장중 가격이 오늘 시가 open + 전일 변동폭 \* K 를 돌파할 때 매수한다.
           (일반적으로 K값은 0.5를 사용하지만, 수익률에 따라 조정하는 것이 좋다.)
    -   3. 장마감 시 무조건 매도한다.

<br>
<hr>
<br>

## 8.2 크레온 플러스 API -> 다른 걸로 대체

### 8.2.5 로그 메시지 출력

-   [8.1_dbgout](./dbgout.py)

<br>
<hr>
<br>

## 8.3 주가 및 계좌 정보 조회

### 8.3.1 현재가 조회

### 8.3.2 OHLC 조회

-   [ohlc](./ohlc.py)

### 8.4.2 매수 목표가 계산

-   매수 목표가 = 금일 시작 가격 + (어제 최고가 - 어제 최고가 ) \* K
-   [get_target_price](./get_target_price.py)

### 8.4.3 이동평균값 조회

-   변동성 돌파 전략의 매수 조건은 현재가가 (시가 + 전일 변동폭의 K%)를 돌파할 때다.
    -   여기에 '현재가가 5일 이동평균선과 10일 이동평균선 위에 있어야 한다'는 조건을 추가하자.
-   [get_movingaverage](./get_movingaverage.py)

### 8.4.4 주식 매매 주문 방식

-   최우선 지정가 주문

    -   매수자의 최우선 지정가 주문 : 호가 접수 시점에서 가장 높은 매수호가
    -   매도자의 최우선 지정가 주문 : 호가 접수 시점에서 가장 낮은 매도호가

-   최유리 지정가 주문

    -   매수자의 최유리 지정가 주문 : 호가 접수 시점에서 가장 낮은 매도호가
    -   매도자의 최유리 지정가 주문 : 호가 접수 시점에서 가장 높은 매도호가

-   FOK(Fill Or Kill)

    -   주문 즉시 전부 체결 또는 전부 취소 조건
    -   호가 접수 시점에서 수량 전부에 대해서 매매계약을 체결할 수 있으면 매매거래를 성립시키되, 수량 전부를 체결할 수 없으면 주문 자체를 취소한다.

-   IOC (Immediate Or Cancel)
    -   주문 즉시 체결 그리고 잔량 자동 취소 조건
    -   호가 접수 시점에서 매매계약을 체결할 수 있는 만큼 매매거래를 성립시키고 매매계약이 체결되지 않은 수량을 취소한다.

### 8.4.5 최유리 FOK 매수 주문

-   오전 09:15부터 오후 03:15까지는 일정 간격으로 매수 종목 후보군의 현재가, 매수 목표가, 5일 이동평균가, 10일 이동평균가를 구해서 매수 조건에 부합하는지 점검할 것이다.
    -   현재가가 매수 목표가, 5일 이동평균가, 10일 이동평균가보다 높을 경우 매수 조건에 부합한 것으로 보고 해당 종목을 최유리 FOK 주문 방식으로 매수한다.
-   ETF 종목은 일반 주식 종목에 비하면 거래량이 그리 많지 않은 경우가 많으므로 한꺼번에 원하는 수량만큼 매수하려면 비싼 가격을 지불하는 경우가 발생할 수 있다.
    -   이러한 상황을 피하려면 최유리 FOK 매수 주문을 통해 현재 가장 낮은 매도호가에 매수 주문을 냄으로써 원하는 가격에 원하는 수량만큼 매수가 가능할 때만 계약이 체결되도록 한다.
-   코드 작성 해야 함 \*\*\* [buy_etf]

### 8.4.6 최유리 IOC 매도 주문

-   오후 03:15부터 03:20까지는 매수했던 주식 종목들을 모두 매도 청산하자.
    -   다음 날 시가에 매도해도 되지만 마감 이후 해외 시장의 영향에 따른 변동성이 생길 수 있으므로, 매수한 종목은 당일 매도하는 것을 원칙으로 삼는다.
-   코드 작성 해야 함 \*\*\* [sell_all]

<br>
<hr>
<br>

## 8.5 메인 로직과 작업 스케줄러 등록

-   구현한 함수들을 시간대별로 동작하도록 하는 것
    -   symbol_list에 지정한 매수 후보군 종목들의 현재가를 주기적으로 조회하다가 목표 가격을 돌파하는 종목을 매수해서 장 마감 시 무조건 매도한다.
    -   단일 종목을 매매하는 것보다 여러 종목을 매매하는 것이 리스크 분산에 유리하기 때문에 본 예제에서는 목표 종목수를 5개를 설정

### 8.5.1 메인 로직과 시간대별 처리

-   장 시간 전부터 장 마감 때까지 자동으로 매매를 수행하는 내용을 시간대별로 정리

#### 시간대별 자동매매 처리 내용

| **시간**          | **실행 파일**    | **내용**                                           |
| ----------------- | ---------------- | -------------------------------------------------- |
| **08:30**         | AutoConnect.py   | 크레온 플러스 강제 종료 및 시작                    |
| **08:40**         | EtfAlogTrader.py | 자동매매 프로그램 시작                             |
| **09:05 ~ 15:15** | EtfAlogTrader.py | 목표 종목수가 달성될 때까지 ETF 종목들을 매수한다. |
| **15:15 ~ 15:20** | EtfAlogTrader.py | 매수했던 종목들을 모두 매도 청산한다.              |
| **15:20 ~**       | EtfAlogTrader.py | 자동 종료한다.                                     |

-   코드 작성 해야 함 \*\*\* [AutoConnect]

### 8.5.2 작업 스케줄러 등록

-   작업 스케줄러에 자동 접속 프로그램 AutoConnectL.py와 자동매매 프로그램 EtfAlgoTrader.py를 등록

#### GPT macOS에서 적용 검색

1. Launchd : LaunchAgents, LaunchDaemons
2. Crontab : 유닉스 기반
3. Third-party Apps : GUI 기반의 작업 스케줄링 도구
    - Lingon X: Launchd를 GUI로 관리할 수 있는 앱.
    - Hammerspoon: 자동화와 키 매핑을 지원하는 유연한 도구.
    - Automator: 간단한 자동화 작업을 위한 macOS 내장 앱.

### 8.5.3 전체 코드 및 실행 결과
